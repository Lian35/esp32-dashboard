<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 IoT Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
  padding:20px;
}
.container { max-width:1200px; margin:auto; }
.card {
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}
.value {
  font-size:3rem;
  font-weight:700;
}
.status {
  display:flex;
  align-items:center;
  gap:8px;
}
.dot {
  width:10px;
  height:10px;
  border-radius:50%;
  background:green;
}
footer {
  text-align:center;
  margin-top:30px;
  color:white;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
  <h1><i class="fas fa-microchip"></i> ESP32 IoT Dashboard</h1>
  <div class="status">
    <span class="dot" id="dot"></span>
    <span id="status">Conectando...</span>
    <span id="time"></span>
  </div>
</div>

<br>

<div class="grid">
  <div class="card">
    <h3>üå°Ô∏è Temperatura</h3>
    <div class="value"><span id="temp">--</span> ¬∞C</div>
  </div>

  <div class="card">
    <h3>üíß Humedad</h3>
    <div class="value"><span id="hum">--</span> %</div>
  </div>

  <div class="card">
    <h3>üåÄ Presi√≥n (simulada)</h3>
    <div class="value"><span id="press">--</span> hPa</div>
  </div>

  <div class="card">
    <h3>üå¨Ô∏è Calidad Aire</h3>
    <div class="value"><span id="air">--</span> AQI</div>
  </div>
</div>

<br>

<div class="card">
  <h3>üìà Hist√≥rico de Temperatura</h3>
  <div id="chart"></div>
</div>

<footer>
<p>ESP32 + ThingSpeak + GitHub Pages</p>
</footer>

</div>

<script>
// ================= CONFIG =================
const CHANNEL_ID = 3229390;
const READ_API_KEY = "IOUT49G2VKRMTKID";

// ================= DOM =================
const tempEl = document.getElementById("temp");
const humEl = document.getElementById("hum");
const pressEl = document.getElementById("press");
const airEl = document.getElementById("air");
const statusEl = document.getElementById("status");
const dotEl = document.getElementById("dot");
const timeEl = document.getElementById("time");

// ================= CHART =================
const chart = new ApexCharts(document.querySelector("#chart"), {
  chart: { type: 'line', height: 300 },
  series: [{ name: "Temperatura", data: [] }],
  xaxis: { type: 'datetime' }
});
chart.render();

// ================= FUNCTIONS =================
function airQuality(t,h){
  return Math.max(0, Math.min(100, Math.round(100 - Math.abs(t-22)*2 - Math.abs(h-50))));
}

async function fetchData(){
  try{
    const res = await fetch(
      `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=1`
    );
    const json = await res.json();
    const d = json.feeds[0];

    const temp = parseFloat(d.field1);
    const hum = parseFloat(d.field2);

    tempEl.textContent = temp.toFixed(1);
    humEl.textContent = hum.toFixed(1);
    pressEl.textContent = (1013 + (temp-20)*0.5).toFixed(1);
    airEl.textContent = airQuality(temp,hum);

    chart.appendData([{ data: [[new Date(d.created_at).getTime(), temp]] }]);

    dotEl.style.background = "green";
    statusEl.textContent = "ESP32 Online";
    timeEl.textContent = new Date().toLocaleTimeString();

  }catch(e){
    dotEl.style.background = "red";
    statusEl.textContent = "Sin conexi√≥n";
  }
}

// ================= START =================
fetchData();
setInterval(fetchData, 10000);
</script>
</body>
</html>
